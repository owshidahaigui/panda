51商城355

音乐排行榜410


智慧考试系统435

登录注册第一个项目参照乐途

第一个项目的用户id数据库自动生成，

登录注册第二个项目参照智慧考试系统
用户id同行uuid生成
redis封装
验证码验证都是通过redis完成
成功之后密码通过hash加密存入数据库
如何实现短信登录
收藏夹，历史足迹，

数据库表：用户足迹表，用户历史订单表，用户购物车表，

部分工具模块，redis封装和login_check token验证



#### 用户手机短信的验证和邮箱激活

注册成功用户保存，用户表create-time,uptdate-time







#### 在用户登录和注册之后都会生成token返回给用户

在用户成功注册之后或者登录成功之后，服务器后台都会生成一个token，加入json中返回给前端，用于权限检查，免密登录等功能，这里调用了Python的jwt模块，将代表用户信息的主键username，和1周的有效期，的数据放到token中，加密方式HS256。

#### 编写token装饰器，需要用户登录token检测的页面有，购物车，收藏夹，个人信息，

对前端请求的权限的检查，我编写了一个token检查的装饰器这个装饰器的主要功能是通过获取request对象的请求头中的token属性，检查token是否是我们服务器发出或者是否过期，来达到对前端的请求进行必要的登录权限检测，这个装饰器，一共有3层函数，最外层函数参数传递请求方法，因为restful api 是根据不同请求方式完成不同请求行为，有时候get的请求方式不需要登录验证，所以在使用装饰器时，不会传入'get'，，里面一层参数是（function）代表被装饰函数名，再里面函数参数就是被装饰函数的参数（request和不等长参数）了，函数执行的逻辑是，最先判断有没有传入请求参数和前端发来的请求的请求方式为要求检查token的类型，如果不满足就只执行被装饰函数的功能，接着从request对象中取出token，判断token是否存在，以及使用jwt模块解析token，检查成功之后，取出token中username属性，查找数据库，如果没有结果表示用户已经删除，返回错误信息，最好将数据对象赋值给request的user属性，用在被装饰器装饰函数的内部。

#### 发表带图软文

用户发表的软文一般上都是带图片的，后端存储的时候，需要根据上传的用户，创建相应的静态文件夹存储，在数据库中存储文件的路径，并且与存储文章的数据库建立外键关联，具体操作是，后端接受到前端发来的post请求，需要使用登录检查token装饰器检查，通过request.body属性中取出json，通过json模块的方法装换成字典对象，根据title，content等key值取出相应的内容并做逻辑判断，不满足要求就返回带有错误信息的json，这里调用HTML模块中的escape函数将文章名的内容进行转换，防止xss攻击，最后将创建文章的entry对象，将文章的所有文本内容保持到数据库，这个过程要求是try，如果存储失败就讲失败的信息返回给前端，

image字段，大量io速度很慢

接着就是要存储文章的图片内容，这里将具体操作封装到一个函数中。需要传入request对象，和文章的entry对象，并根据函数返回的内容判断是否存储成功，函数内部，调用request对象，FLIES属性的getlist方法取出图片对象列表，通过遍历创建图片的entry对象将每个图片存储到静态文件夹中，路径存储到数据库中，图片的model类中路径path字段的值是根据用户username，和文章id生成的，依靠动态生成upload_to的属性值来完成的。我们封装了一个函数来完成，这个函数需要传入图片对象和上传的文件名，将用户名主键，文章主键id，还有截取的uuid模块生成的唯一名字和原文件的格式，生一个唯一路径。不同用户，不同文章的图片存储到不同的文件夹下，图片的文件名也是唯一的。

头像上传图片也是与此类似，不过最外层username目录是动态动态的，在里面就是统一放到头像目录下，并由uuid生成的唯一标识作为文件名，再更新用户表里头像字段值。



#### 软文评论功能

后台存储软文评论时，形成了链式结构的方式，评论数据库除了有id，评论内容，评论文章，评论用户的字段外，还有个parent_message_id的父评论id字段，用以表示此评论的上一个节点评论的回复，前端请求评论页面时，后端会用文章id，将此文下的所有的评论内容，通过一次IO全部取出来，



#### 记录足迹使用redis缓存，键值为history+username

redis 缓存顾客的浏览足迹，当用户进入网页就会先判断是否登录，如果是已经登录的用户就会以该用户的username，游客用户的话，就会以uuid模块生成的唯一标识摸为键值生成一个有序集合结构，用户每次放起一个页面请求（不包括登录注册页面），我们就将URL和时间搓，append到有序集合中，并这个键放到cookie中区放回给用户，每次通过cookie的键值，把用户的URL存到相应的redis中，游客在注册登录后也可以直接返回最近一次浏览的页面URL放到json返回前端，在顾客结束回话后，就把有序集合中的值，插入的MySQL数据库中去永久存储后。如果顾客没有登录就退出则直接销毁。对与已经登录的用户就直接username为键，把浏览的URL存到redis中去，会话结束时，在永久存储到MySQL中。

#### 购物车，和收藏夹redist缓存

用户在完成第一次登录检查之后，就会把用户信息相关的购物车及收藏夹信息，缓存的键值cart+username的redis列表中



#### 你在项目中遇到的问题，

数据库设计上，比如文章的所有内容都是放到一张表里面是的，而正文内容最多却在很多适合不需要查询，影响了数据库的效率，重新建立了一张副表用以存储软文的正文，并与主表形成一对一的外键相连。























